-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public._prisma_migrations (
  id character varying NOT NULL,
  checksum character varying NOT NULL,
  finished_at timestamp with time zone,
  migration_name character varying NOT NULL,
  logs text,
  rolled_back_at timestamp with time zone,
  started_at timestamp with time zone NOT NULL DEFAULT now(),
  applied_steps_count integer NOT NULL DEFAULT 0,
  CONSTRAINT _prisma_migrations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  action character varying NOT NULL,
  entity character varying NOT NULL,
  entity_id uuid,
  user_id uuid NOT NULL,
  target_user_id uuid,
  organization_id uuid NOT NULL,
  old_values jsonb,
  new_values jsonb,
  changes jsonb,
  ip_address inet,
  user_agent text,
  request_id character varying,
  session_id character varying,
  reason text,
  metadata jsonb DEFAULT '{}'::jsonb,
  timestamp timestamp with time zone DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT audit_logs_target_user_id_fkey FOREIGN KEY (target_user_id) REFERENCES public.users(id),
  CONSTRAINT audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT audit_logs_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.customers (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  phone character varying,
  email character varying,
  address text,
  city character varying,
  state character varying,
  country character varying,
  postal_code character varying,
  date_of_birth date,
  gender character varying,
  medical_history text,
  allergies text,
  emergency_contact character varying,
  emergency_phone character varying,
  is_active boolean DEFAULT true,
  organization_id uuid NOT NULL,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT customers_pkey PRIMARY KEY (id),
  CONSTRAINT customers_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT customers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.inventory_transactions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  medicine_id uuid NOT NULL,
  organization_id uuid NOT NULL,
  transaction_type character varying NOT NULL,
  quantity integer NOT NULL,
  unit_price numeric,
  total_amount numeric,
  reference_id uuid,
  reference_type character varying,
  notes text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT inventory_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT inventory_transactions_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT inventory_transactions_medicine_id_fkey FOREIGN KEY (medicine_id) REFERENCES public.medicines(id),
  CONSTRAINT inventory_transactions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.medicines (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  generic_name character varying,
  manufacturer character varying NOT NULL,
  batch_number character varying,
  selling_price numeric NOT NULL,
  cost_price numeric NOT NULL,
  gst_per_unit numeric DEFAULT 0,
  gst_rate numeric DEFAULT 0,
  quantity integer NOT NULL DEFAULT 0,
  low_stock_threshold integer DEFAULT 10,
  expiry_date date NOT NULL,
  category character varying,
  subcategory character varying,
  description text,
  dosage_form character varying,
  strength character varying,
  pack_size character varying,
  storage_conditions character varying,
  prescription_required boolean DEFAULT false,
  is_active boolean DEFAULT true,
  organization_id uuid NOT NULL,
  supplier_id uuid,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT medicines_pkey PRIMARY KEY (id),
  CONSTRAINT medicines_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT medicines_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT medicines_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.order_items (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  order_id uuid NOT NULL,
  medicine_id uuid NOT NULL,
  quantity integer NOT NULL,
  unit_price numeric NOT NULL,
  total_price numeric NOT NULL,
  discount numeric DEFAULT 0,
  discount_percent numeric DEFAULT 0,
  cost_price numeric NOT NULL,
  profit numeric NOT NULL DEFAULT 0,
  gst_amount numeric DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT order_items_pkey PRIMARY KEY (id),
  CONSTRAINT order_items_medicine_id_fkey FOREIGN KEY (medicine_id) REFERENCES public.medicines(id),
  CONSTRAINT order_items_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id)
);
CREATE TABLE public.orders (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  order_number character varying NOT NULL UNIQUE,
  user_id uuid,
  customer_name character varying,
  customer_phone character varying,
  customer_email character varying,
  organization_id uuid NOT NULL,
  total_amount numeric NOT NULL,
  tax_amount numeric NOT NULL DEFAULT 0,
  tax_percent numeric DEFAULT 0,
  subtotal numeric NOT NULL DEFAULT 0,
  profit numeric NOT NULL DEFAULT 0,
  discount numeric NOT NULL DEFAULT 0,
  discount_percent numeric DEFAULT 0,
  payment_method character varying NOT NULL,
  payment_status character varying DEFAULT 'pending'::character varying,
  status character varying DEFAULT 'pending'::character varying,
  notes text,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT orders_pkey PRIMARY KEY (id),
  CONSTRAINT orders_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT orders_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.organizations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  code character varying NOT NULL UNIQUE,
  description text,
  address text,
  phone character varying,
  email character varying,
  website character varying,
  logo_url text,
  is_active boolean DEFAULT true,
  subscription_tier character varying DEFAULT 'basic'::character varying,
  max_users integer DEFAULT 5,
  current_users integer DEFAULT 0,
  trial_ends_at timestamp with time zone,
  access_valid_till timestamp with time zone,
  billing_email character varying,
  tax_id character varying,
  currency character varying DEFAULT 'USD'::character varying,
  timezone character varying DEFAULT 'UTC'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT organizations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.purchase_order_items (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  purchase_order_id uuid NOT NULL,
  medicine_id uuid NOT NULL,
  quantity integer NOT NULL,
  unit_cost numeric NOT NULL,
  total_cost numeric NOT NULL,
  received_quantity integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT purchase_order_items_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_order_items_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES public.purchase_orders(id),
  CONSTRAINT purchase_order_items_medicine_id_fkey FOREIGN KEY (medicine_id) REFERENCES public.medicines(id)
);
CREATE TABLE public.purchase_orders (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  po_number character varying NOT NULL UNIQUE,
  supplier_id uuid NOT NULL,
  organization_id uuid NOT NULL,
  total_amount numeric NOT NULL,
  tax_amount numeric DEFAULT 0,
  discount numeric DEFAULT 0,
  status character varying DEFAULT 'pending'::character varying,
  order_date date NOT NULL DEFAULT CURRENT_DATE,
  expected_delivery date,
  actual_delivery date,
  notes text,
  created_by uuid,
  approved_by uuid,
  approved_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT purchase_orders_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_orders_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT purchase_orders_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id),
  CONSTRAINT purchase_orders_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT purchase_orders_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.suppliers (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  contact_person character varying,
  phone character varying,
  email character varying,
  address text,
  city character varying,
  state character varying,
  country character varying,
  postal_code character varying,
  website character varying,
  tax_id character varying,
  payment_terms character varying,
  credit_limit numeric,
  current_balance numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  organization_id uuid NOT NULL,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT suppliers_pkey PRIMARY KEY (id),
  CONSTRAINT suppliers_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT suppliers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.user_inventory (
  id text NOT NULL,
  userId text NOT NULL,
  name text NOT NULL,
  genericName text,
  manufacturer text NOT NULL,
  batchNumber text,
  category text,
  description text,
  sellingPrice text NOT NULL,
  costPrice text NOT NULL,
  marginPercentage double precision NOT NULL DEFAULT 0,
  quantity integer NOT NULL DEFAULT 0,
  lowStockThreshold integer NOT NULL DEFAULT 10,
  criticalStockLevel integer NOT NULL DEFAULT 5,
  reorderPoint integer NOT NULL DEFAULT 15,
  expiryDate timestamp without time zone NOT NULL,
  manufacturingDate timestamp without time zone,
  isExpired boolean NOT NULL DEFAULT false,
  daysToExpiry integer,
  isActive boolean NOT NULL DEFAULT true,
  isLocked boolean NOT NULL DEFAULT false,
  requiresPrescription boolean NOT NULL DEFAULT false,
  isControlledSubstance boolean NOT NULL DEFAULT false,
  gstRate double precision NOT NULL DEFAULT 0,
  gstPerUnit double precision NOT NULL DEFAULT 0,
  taxCategory text NOT NULL DEFAULT 'standard'::text,
  supplierId text,
  supplierName text,
  supplierProductCode text,
  lastPurchasePrice text,
  lastPurchaseDate timestamp without time zone,
  totalSold integer NOT NULL DEFAULT 0,
  totalRevenue text NOT NULL DEFAULT '0'::text,
  averageMonthlySales double precision NOT NULL DEFAULT 0,
  lastSaleDate timestamp without time zone,
  createdAt timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt timestamp without time zone NOT NULL,
  CONSTRAINT user_inventory_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_ledger (
  id text NOT NULL,
  userId text NOT NULL,
  transactionType text NOT NULL,
  description text NOT NULL,
  referenceNumber text,
  amount text NOT NULL,
  debitAmount text NOT NULL DEFAULT '0'::text,
  creditAmount text NOT NULL DEFAULT '0'::text,
  runningBalance text NOT NULL,
  category text NOT NULL,
  subCategory text,
  paymentMethod text,
  orderId text,
  supplierId text,
  customerId text,
  isVerified boolean NOT NULL DEFAULT false,
  verifiedBy text,
  verifiedAt timestamp without time zone,
  metadata jsonb NOT NULL DEFAULT '{}'::jsonb,
  transactionDate timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  createdAt timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt timestamp without time zone NOT NULL,
  CONSTRAINT user_ledger_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_notes (
  id text NOT NULL,
  userId text NOT NULL,
  title text NOT NULL,
  content text NOT NULL,
  tags ARRAY DEFAULT ARRAY[]::text[],
  category text NOT NULL DEFAULT 'general'::text,
  isPrivate boolean NOT NULL DEFAULT true,
  isEncrypted boolean NOT NULL DEFAULT false,
  isPinned boolean NOT NULL DEFAULT false,
  color text NOT NULL DEFAULT '#ffffff'::text,
  relatedItemType text,
  relatedItemId text,
  createdAt timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt timestamp without time zone NOT NULL,
  CONSTRAINT user_notes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_preferences (
  id text NOT NULL,
  userId text NOT NULL,
  category text NOT NULL,
  key text NOT NULL,
  value jsonb NOT NULL,
  isEncrypted boolean NOT NULL DEFAULT false,
  createdAt timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt timestamp without time zone NOT NULL,
  CONSTRAINT user_preferences_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_reminders (
  id text NOT NULL,
  userId text NOT NULL,
  title text NOT NULL,
  description text,
  type text NOT NULL,
  priority text NOT NULL DEFAULT 'medium'::text,
  reminderDate timestamp without time zone NOT NULL,
  isRecurring boolean NOT NULL DEFAULT false,
  recurringInterval text,
  isCompleted boolean NOT NULL DEFAULT false,
  completedAt timestamp without time zone,
  isActive boolean NOT NULL DEFAULT true,
  relatedItemType text,
  relatedItemId text,
  createdAt timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt timestamp without time zone NOT NULL,
  CONSTRAINT user_reminders_pkey PRIMARY KEY (id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  supabase_uid uuid NOT NULL UNIQUE,
  username character varying NOT NULL UNIQUE,
  email character varying NOT NULL UNIQUE,
  full_name character varying,
  phone character varying,
  avatar_url text,
  role character varying DEFAULT 'user'::character varying,
  role_in_pos character varying,
  permissions jsonb DEFAULT '[]'::jsonb,
  organization_id uuid NOT NULL,
  subscription_status character varying DEFAULT 'pending'::character varying,
  access_valid_till timestamp with time zone,
  trial_ends_at timestamp with time zone,
  last_access_extension timestamp with time zone,
  is_trial_user boolean DEFAULT true,
  is_active boolean DEFAULT false,
  is_email_verified boolean DEFAULT false,
  last_login timestamp with time zone,
  login_attempts integer DEFAULT 0,
  locked_until timestamp with time zone,
  password_reset_token character varying,
  password_reset_expires timestamp with time zone,
  two_factor_enabled boolean DEFAULT false,
  two_factor_secret character varying,
  preferences jsonb DEFAULT '{}'::jsonb,
  theme character varying DEFAULT 'light'::character varying,
  language character varying DEFAULT 'en'::character varying,
  timezone character varying DEFAULT 'UTC'::character varying,
  notification_settings jsonb DEFAULT '{}'::jsonb,
  created_by uuid,
  approved_by uuid,
  approved_at timestamp with time zone,
  deactivated_by uuid,
  deactivated_at timestamp with time zone,
  deactivation_reason text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT users_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT users_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT users_deactivated_by_fkey FOREIGN KEY (deactivated_by) REFERENCES public.users(id)
);